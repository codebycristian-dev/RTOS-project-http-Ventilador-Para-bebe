<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script src="jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="app.css">
    <script async src="app.js"></script>
    <title>ESP32 Control Panel</title>
</head>
<body>
    <div class="page">
        <header class="hero">
            <div class="hero__text">
                <p class="eyebrow">ESP32</p>
                <h1>Control Center</h1>
                <p class="subtitle">Gestiona tu dispositivo, credenciales y horarios en un panel limpio inspirado en iOS.</p>
            </div>
            <div class="hero__badge">
                <div class="badge__label" id="latest_firmware_label">Latest Firmware</div>
                <div class="badge__value" id="latest_firmware">--</div>
            </div>
        </header>

        <main class="grid">
            <section class="card" id="OTA">
                <div class="card__header">
                    <p class="eyebrow">OTA</p>
                    <h2>ESP32 Firmware Update</h2>
                </div>
                <div class="card__content stack">
                    <input type="file" id="selected_file" accept=".bin" onchange="getFileInfo()" hidden />
                    <div class="actions">
                        <button class="btn ghost" type="button" onclick="document.getElementById('selected_file').click();">Select File</button>
                        <button class="btn primary" type="button" onclick="updateFirmware()">Update Firmware</button>
                    </div>
                    <div class="status" id="file_info"></div>
                    <div class="status highlight" id="ota_update_status"></div>
                </div>
            </section>

            <section class="card" id="WiFiConnect">
                <div class="card__header">
                    <p class="eyebrow">Conectividad</p>
                    <h2>ESP32 WiFi Connect</h2>
                </div>
                <div class="card__content stack">
                    <label class="field">
                        <span>SSID</span>
                        <input id="connect_ssid" type="text" maxlength="32" placeholder="Red WiFi">
                    </label>
                    <label class="field">
                        <span>Password</span>
                        <input id="connect_pass" type="password" maxlength="64" placeholder="Ingresa la clave">
                    </label>
                    <label class="checkbox">
                        <input type="checkbox" onclick="showPassword()">
                        <span>Mostrar password</span>
                    </label>
                    <div class="actions">
                        <button class="btn primary" id="connect_wifi" type="button">Connect</button>
                        <button class="btn secondary" type="button" onclick="toogle_led()">Toggle LED</button>
                    </div>
                    <div class="status error" id="wifi_connect_credentials_errors"></div>
                    <div class="status" id="wifi_connect_status"></div>
                </div>
            </section>
            <!-- ====================== -->
            <!--   VENTILADOR INTELIGENTE  -->
            <!-- ====================== -->
            
            <div class="section-block">
                <h2 class="section-title">Ventilador Inteligente</h2>
            
                <!-- Estado del ventilador -->
                <div class="card">
                    <h3 class="card-title">Estado actual</h3>
                    <p>Temperatura: <span id="fan_temp">--</span> °C</p>
                    <p>Presencia: <span id="fan_presence">--</span></p>
                    <p>PWM actual: <span id="fan_pwm">--</span>%</p>
                </div>
            
                <!-- Selector de modo -->
                <div class="card">
                    <h3 class="card-title">Modo de funcionamiento</h3>
            
                    <div class="segmented-control">
                        <button class="segment" id="mode_manual" onclick="setFanMode(0)">Manual</button>
                        <button class="segment" id="mode_auto" onclick="setFanMode(1)">Automático</button>
                        <button class="segment" id="mode_program" onclick="setFanMode(2)">Programado</button>
                    </div>
                </div>
            
                <!-- ===== MODO MANUAL ===== -->
                <div class="card" id="card_manual" style="display:none;">
                    <h3 class="card-title">Velocidad manual</h3>
                    <input type="range" id="manual_pwm" min="0" max="100" value="0" oninput="updateManualLabel()">
                    <p>Velocidad: <span id="manual_pwm_label">0</span>%</p>
            
                    <button onclick="saveManualPWM()" class="btn-primary">Guardar</button>
                </div>
            
                <!-- ===== MODO AUTOMÁTICO ===== -->
                <div class="card" id="card_auto" style="display:none;">
                    <h3 class="card-title">Configuración automática</h3>
            
                    <p>Tmin (0% PWM)</p>
                    <input type="number" id="auto_tmin" step="0.1" oninput="autoLocalTmin = this.value">
    
                    <p>Tmax (100% PWM)</p>
                    <input type="number" id="auto_tmax" step="0.1" oninput="autoLocalTmax = this.value">
            
                    <button onclick="saveAutoConfig()" class="btn-primary">Guardar</button>
                </div>
            
                <!-- ===== MODO PROGRAMADO ===== -->
                <div class="card" id="card_program" style="display:none;">
                    <h3 class="card-title">Registros programados</h3>
            
                    <div id="program_blocks"></div>
            
                    <button onclick="loadRegisters()" class="btn-secondary">Recargar registros</button>
                </div>
            </div>
        </main>
    </div>
</body>
</html>

